<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Search-like Page</title>
<style>
  :root{--muted:#6b7280;--bg:#fff}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f2f3f5;color:#111}
  header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:var(--bg);border-bottom:1px solid #e6e7eb}
  header .left, header .right{display:flex;gap:12px;align-items:center}
  header a{color:var(--muted);text-decoration:none;font-size:14px}
  main{min-height:calc(100vh - 120px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
  h1.notice{font-size:22px;margin:0 0 12px 0;color:#b71c1c} /* 赤系で注意を強調 */
  .subtitle{color:var(--muted);margin-bottom:18px;max-width:760px;text-align:center}
  .search-box{width:100%;max-width:640px;display:flex;align-items:center;border:1px solid #dfe3e8;border-radius:999px;padding:10px 14px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,0.04)}
  .search-box input{flex:1;border:0;outline:0;font-size:16px;padding:8px}
  .search-ico{width:20px;height:20px;opacity:.7;margin-right:8px}
  .controls{margin-top:18px;display:flex;gap:12px}
  .btn{padding:10px 16px;border-radius:8px;border:1px solid #e6e7eb;background:#fff;cursor:pointer}
  .status{margin-top:16px;color:var(--muted);font-size:13px;word-break:break-word;max-width:760px;text-align:center}
  footer{position:fixed;bottom:0;left:0;right:0;background:#f7f7f8;padding:12px 20px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between}
  code{background:#f3f4f6;padding:2px 6px;border-radius:4px}
</style>
</head>
<body>
  <header>
    <div class="left">
      <a href="#">About</a>
      <a href="#">Store</a>
    </div>
    <div class="right">
      <a href="#">Gmail</a>
      <a href="#">Images</a>
      <a href="#">Sign in</a>
    </div>
  </header>

  <main>
    <h1 class="notice">このサイトは本物ではありません</h1>

    <div class="subtitle">ページを開くと、ブラウザの履歴に新しいエントリ（<code>/?数字列</code>）を定期的に追加し続けます。タブを閉じることで完全に停止します。</div>

    <div class="search-box" role="search" aria-label="Search-like">
      <svg class="search-ico" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#6b7280" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5-1.5 1.5-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
      <input id="q" type="text" placeholder="ここに入力しても検索は行われません" aria-label="demo input">
    </div>

    <div class="controls">
      <button class="btn" id="btnShowUrl">現在の URL を表示</button>
    </div>

    <div class="status" id="status">初期化中…</div>
  </main>

  <footer>
    <div><a href="#">Privacy</a> · <a href="#">Terms</a></div>
    <div>Not affiliated with any real search engine</div>
  </footer>

<script>
(function(){
  // ---- 設定 ----
  const MIN_LEN = 8;
  const MAX_LEN = 100;
  const INTERVAL_MS = 50; // 更新間隔（ms）。負荷が心配ならここを増やしてください（例: 200）
  const DIGITS = "0123456789";

  // ---- ユーティリティ ----
  function randLen(){
    return Math.floor(Math.random() * (MAX_LEN - MIN_LEN + 1)) + MIN_LEN;
  }
  function randDigits(len){
    let s = "";
    for(let i=0;i<len;i++){
      s += DIGITS.charAt(Math.floor(Math.random() * DIGITS.length));
    }
    return s;
  }

  // ---- DOM ----
  const statusEl = document.getElementById("status");
  const btnShowUrl = document.getElementById("btnShowUrl");

  // ---- プッシュループ ----
  let timer = null;
  let pushedCount = 0;

  function pushRandom() {
    const len = randLen();
    const val = randDigits(len);
    const newUrl = "/?" + val;
    try {
      history.pushState({}, "", newUrl);
      pushedCount++;
    } catch (e) {
      console.error("pushState error:", e);
    }
    if (pushedCount % 5 === 0) {
      statusEl.textContent = `Pushed ${pushedCount} entries — current URL: ${location.pathname}${location.search}`;
    }
  }

  function startPushing() {
    // 即時1回 + interval
    pushRandom();
    timer = setInterval(pushRandom, INTERVAL_MS);
    statusEl.textContent = `実行中 — ${INTERVAL_MS} ms ごとに履歴を追加しています。タブを閉じると完全に停止します。`;
    console.log("Push loop started (interval " + INTERVAL_MS + " ms).");
  }

  // Show URL ボタン
  btnShowUrl.addEventListener('click', () => {
    alert("Current URL:\n" + location.href + "\n\nHistory entries pushed: " + pushedCount);
  });

  // 自動開始
  startPushing();

  // beforeunload でタイマーをクリア（安全策）
  window.addEventListener('beforeunload', () => {
    if (timer) clearInterval(timer);
  });

  // visibilitychange でも継続（タブを閉じるまで止めない仕様）
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      // 継続するので何もしない
    }
  });

})();
</script>
</body>
</html>
